<?xml version="1.0" encoding="UTF-8" standalone="no"?><templates><template autoinsert="true" context="com.sap.adt.cds.ddl.ui.template.context.type.view.creation" deleted="false" description="BPC Dimension in a flat 9 level hierarchy view" enabled="true" name="define_BPC_FLAT_HIER_VIEW">@AbapCatalog.sqlViewName: 'ZVBPC_$$DIMENSIONHF'&#13;
@AbapCatalog.compiler.compareFilter: true&#13;
@AbapCatalog.preserveKey: true&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@EndUserText.label: 'ZBPC_$$DIMENSIONHF'&#13;
define view ZBPC_$$DIMENSIONHF as &#13;
select from ZBPC_$$DIMENSION_H as H&#13;
left outer join ZBPC_$$DIMENSION as M on H.Nodename = M.ID and H.objvers = M.objvers &#13;
left outer join ZBPC_$$DIMENSION_H as H1&#13;
    on H.Hieid = H1.Hieid and H.objvers = H1.objvers and H.Parentid = H1.Nodeid&#13;
left outer join ZBPC_$$DIMENSION_H as H2&#13;
    on H1.Hieid = H2.Hieid and H1.objvers = H2.objvers and H1.Parentid = H2.Nodeid  &#13;
left outer join ZBPC_$$DIMENSION_H as H3&#13;
    on H2.Hieid = H3.Hieid and H2.objvers = H3.objvers and H2.Parentid = H3.Nodeid      &#13;
left outer join ZBPC_$$DIMENSION_H as H4&#13;
    on H3.Hieid = H4.Hieid and H3.objvers = H4.objvers and H3.Parentid = H4.Nodeid&#13;
left outer join ZBPC_$$DIMENSION_H as H5&#13;
    on H4.Hieid = H5.Hieid and H4.objvers = H5.objvers and H4.Parentid = H5.Nodeid&#13;
left outer join ZBPC_$$DIMENSION_H as H6&#13;
    on H5.Hieid = H6.Hieid and H5.objvers = H6.objvers and H5.Parentid = H6.Nodeid    &#13;
left outer join ZBPC_$$DIMENSION_H as H7&#13;
    on H6.Hieid = H7.Hieid and H6.objvers = H7.objvers and H6.Parentid = H7.Nodeid&#13;
left outer join ZBPC_$$DIMENSION_H as H8&#13;
    on H7.Hieid = H8.Hieid and H7.objvers = H8.objvers and H7.Parentid = H8.Nodeid&#13;
left outer join ZBPC_$$DIMENSION_H as H9&#13;
    on H8.Hieid = H9.Hieid and H8.objvers = H9.objvers and H8.Parentid = H9.Nodeid                                        &#13;
{&#13;
H.Hieid&#13;
,H.Nodeid&#13;
,H.objvers&#13;
,H.Dimension&#13;
,H.HIER_NAME&#13;
,H.Iobjnm&#13;
,H.Nodename&#13;
,H.NodeDesc&#13;
,H.Tlevel&#13;
,H.Link&#13;
,H.Parentid as PARENT_LV1_ID&#13;
,H1.Parentid as PARENT_LV2_ID&#13;
,H2.Parentid as PARENT_LV3_ID&#13;
,H3.Parentid as PARENT_LV4_ID&#13;
,H4.Parentid as PARENT_LV5_ID&#13;
,H5.Parentid as PARENT_LV6_ID&#13;
,H6.Parentid as PARENT_LV7_ID&#13;
,H7.Parentid as PARENT_LV8_ID&#13;
,H8.Parentid as PARENT_LV9_ID&#13;
,H.Childid&#13;
,H.Nextid    &#13;
,M.ID&#13;
,M.mbr_name&#13;
,M.SID&#13;
&#13;
$$LIST_OF_ATTR&#13;
&#13;
,M.EVDESCRIPTION&#13;
,M.CALC&#13;
,M.SCALING&#13;
,M.HIR&#13;
,M.PARENTH1&#13;
,M.PARENTH2&#13;
,M.PARENTH3&#13;
,M.PARENTH4&#13;
,M.PARENTH5&#13;
,M.PARENTH6&#13;
,M.PARENTH7&#13;
,M.PARENTH8&#13;
,M.PARENTH9&#13;
,M.PARENTH10&#13;
,H1.Nodename as PARENT_LV1&#13;
,H2.Nodename as PARENT_LV2&#13;
,H3.Nodename as PARENT_LV3&#13;
,H4.Nodename as PARENT_LV4&#13;
,H5.Nodename as PARENT_LV5&#13;
,H6.Nodename as PARENT_LV6&#13;
,H7.Nodename as PARENT_LV7&#13;
,H8.Nodename as PARENT_LV8&#13;
,H9.Nodename as PARENT_LV9&#13;
,case &#13;
when not H9.Nodename is null then '9'&#13;
when not H8.Nodename is null then '8'&#13;
when not H7.Nodename is null then '7'&#13;
when not H6.Nodename is null then '6'&#13;
when not H5.Nodename is null then '5'&#13;
when not H4.Nodename is null then '4'&#13;
when not H3.Nodename is null then '3'&#13;
when not H2.Nodename is null then '2'&#13;
when not H1.Nodename is null then '1'&#13;
else '0'&#13;
end as TRUE_LEVEL&#13;
}&#13;
where H.objvers = 'A'&#13;
</template><template autoinsert="true" context="com.sap.adt.cds.ddl.ui.template.context.type.view.creation" deleted="false" description="define_BPC_HIER_SOURCE_View" enabled="true" name="define_BPC_HIER_SOURCE_View">@AbapCatalog.sqlViewName: 'ZVBW_$$DIMENSION_H'&#13;
@ClientDependent: false&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@AbapCatalog.compiler.compareFilter: true&#13;
@AbapCatalog.preserveKey: true&#13;
@EndUserText.label: '$$DIMENSION Hierarchies'&#13;
// entity and time have nop scaling&#13;
define view ZBW_$$DIMENSION_H as&#13;
select from /b28/h$$ROOTDIM as H&#13;
inner join zvbpc_dim_hiers as MH on MH.hieid = H.hieid and MH.appsetid = 'TRACTEBEL_GLO' and MH.dimension = '$$DIMENSION'&#13;
left outer join rsthiernode as T on T.hieid = H.hieid and H.nodename = T.nodename and H.objvers = T.objvers and H.objvers = 'A'&#13;
and T.langu = $$session.system_language&#13;
left outer join /b28/t$$ROOTDIM as MT on MT./b28/s_$$ROOTDIM = H.nodename and MT.langu = $$session.system_language&#13;
left outer join /b28/h$$ROOTDIM as H2 on H.parentid = H2.nodeid and H.hieid = H2.hieid&#13;
left outer join /b28/t$$ROOTDIM as MT2 on MT2./b28/s_$$ROOTDIM = H2.nodename and MT2.langu = $$session.system_language&#13;
left outer join /b28/p$$ROOTDIM as WM on H.nodename = WM./b28/s_$$ROOTDIM and WM.objvers = H.objvers&#13;
left outer join /1cpmb/$$ROOTDIM as BM on H.nodename = BM./cpmb/$$ROOTDIM and BM.objvers = 'A'&#13;
{&#13;
key H.hieid,&#13;
key MH.caption as hier_name,&#13;
key cast(H.parentid  as abap.int8) as parent_id,&#13;
key cast(H.nodeid as abap.int8) as node_id,&#13;
H.nodename,&#13;
H.iobjnm,&#13;
coalesce(coalesce(T.txtmd,T.txtsh),MT.txtlg) as txtmdtx,&#13;
cast(H.parentid as rsparent ) as parentido,&#13;
cast(H.nodeid as rshienodid ) as nodeido,&#13;
H2.nodename as parent_nodename,&#13;
MT2.txtlg as parent_txtmdtx,&#13;
// to get the leafs IS_NODE = N or HIERARCHY_TREE_SIZE = 1&#13;
WM./b28/s_calc as IS_NODE,&#13;
WM./b28/s_hir as HIR,&#13;
H.tlevel,&#13;
// /b28/s_scaling as SCALING, no scaling in entity type dimension&#13;
&#13;
&#13;
$$LIST_OF_PROPERTIES&#13;
//Ctrl+7&#13;
,BM.parenth1 as PARENTH1&#13;
,BM.parenth2 as PARENTH2&#13;
,BM.parenth3 as PARENTH3&#13;
,BM.parenth4 as PARENTH4&#13;
,BM.parenth5 as PARENTH5&#13;
,BM.parenth6 as PARENTH6&#13;
,BM.parenth7 as PARENTH7&#13;
,BM.parenth8 as PARENTH8&#13;
&#13;
}</template><template autoinsert="true" context="com.sap.adt.cds.ddl.ui.template.context.type.tablefunction.creation" deleted="false" description="BPC Relationship Dimension Table Function Hierarchy " enabled="true" name="define_BPC_HIER_TableFunctionWithParameters">@EndUserText.label: '$$RELATIONSHIP for $$DIMENSION Hierarchy'&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@ClientDependent: false&#13;
&#13;
define table function ZTF_$$DIMENSION_$$RS&#13;
with parameters &#13;
p_hiename : UJ_CAPTION,&#13;
//p_topnodename : RSSHNODENAME,&#13;
p_nodename : RSDM4NODENAME&#13;
returns {&#13;
  nodename : RSSHNODENAME;&#13;
  nodedesc : /BI0/OIBPCTXTLG;&#13;
  parent_nodename : RSSHNODENAME;&#13;
  parent_nodedesc : /BI0/OIBPCTXTLG;&#13;
  is_node : ESH_E_LTXT_IS_NODE_FIELD;&#13;
//  start_id: abap.int8;&#13;
  parentid: abap.int8;&#13;
  childid: abap.int8;&#13;
  hieid : RSHIEID;&#13;
  hier_name : UJ_CAPTION;&#13;
//  hlevel : RSTLEVEL;&#13;
  tlevel : RSTLEVEL;&#13;
  nodeselected : RSDM4NODENAME;  &#13;
  $$LIST_OF_PROPERTIES;&#13;
//EVDESCRIPTION   :       ;&#13;
//CALC    :   /B28/OICALC ;&#13;
HIR :   /B28/OIHIR  ;&#13;
PARENTH1 : UJ_DIM_MEMBER;&#13;
PARENTH2 : UJ_DIM_MEMBER;&#13;
PARENTH3 : UJ_DIM_MEMBER;&#13;
PARENTH4 : UJ_DIM_MEMBER;&#13;
PARENTH5 : UJ_DIM_MEMBER;&#13;
PARENTH6 : UJ_DIM_MEMBER;&#13;
PARENTH7 : UJ_DIM_MEMBER;&#13;
PARENTH8 : UJ_DIM_MEMBER;    &#13;
  }&#13;
  implemented by method zcl_bpc_amdp_hd_$$DIMENSION=&gt;get_$$RELATIONSHIP;</template><template autoinsert="false" context="com.sap.adt.cds.ddl.ui.template.context.type.view.creation" deleted="false" description="BPC Dimension Hierarchy View" enabled="true" name="define_BPC_HIER_VIEW">@AbapCatalog.sqlViewName: 'ZVBPC_$$DIMENSION_H'&#13;
@AbapCatalog.compiler.compareFilter: true&#13;
@AbapCatalog.preserveKey: true&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@EndUserText.label: 'Hierarchies $$DIMENSION'&#13;
define view ZBPC_$$DIMENSION_H as &#13;
select from /b28/h$$ROOT as H&#13;
left outer join /b28/t$$ROOT as T&#13;
on H.nodename = T./b28/s_$$ROOT  and T.langu = $$session.system_language&#13;
left outer join rsthiernode as TN&#13;
on H.nodename = TN.nodename and H.iobjnm = '0HIER_NODE' and TN.langu = T.langu and TN.objvers = H.objvers&#13;
inner join ZBPC_DIM_HIERS as Z on Z.hieid = H.hieid&#13;
 {&#13;
key H.hieid as Hieid &#13;
,key H.nodeid as Nodeid&#13;
,key H.objvers&#13;
,Z.Dimension&#13;
,Z.caption as HIER_NAME&#13;
,H.iobjnm as Iobjnm&#13;
,H.nodename as Nodename&#13;
,coalesce(T.txtlg,TN.txtlg) as NodeDesc&#13;
,H.tlevel as Tlevel&#13;
,H.link as Link&#13;
,H.parentid as Parentid&#13;
,H.childid as Childid&#13;
,H.nextid as Nextid&#13;
//H.signch as Signch    &#13;
}</template><template autoinsert="true" context="com.sap.adt.cds.ddl.ui.template.context.type.view.creation" deleted="false" description="Define BPC Master Data View" enabled="true" name="define_BPC_MDATA_ViewWithJoin">@AbapCatalog.sqlViewName: 'ZVBPC_$$DIMENSION'&#13;
@EndUserText.label: 'BPC Dimension $$DIMENSION'&#13;
@ClientHandling.type: #CLIENT_DEPENDENT&#13;
//@ClientHandling.algorithm: #SESSION_VARIABLE&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@AbapCatalog.compiler.compareFilter: true&#13;
@AbapCatalog.preserveKey: true&#13;
&#13;
define view ZBPC_$$DIMENSION as &#13;
select from /b28/p$$DIMROOT as M&#13;
left outer join /1cpmb/B$$DIMROOT as BM&#13;
on M./b28/s_$$DIMROOT = BM./cpmb/$$DIMROOT &#13;
or M./b28/s_$$DIMROOT = BM.mbr_name&#13;
and M.objvers = BM.objvers &#13;
left outer join /b28/t$$DIMROOT as T &#13;
on M./b28/s_$$DIMROOT = T./b28/s_$$DIMROOT and T.langu = $$session.system_language&#13;
left outer join /b28/s$$DIMROOT as S &#13;
on S./b28/s_$$DIMROOT = M./b28/s_$$DIMROOT &#13;
{&#13;
key cast(M./b28/s_$$DIMROOT as /B28/OI$$DIMROOT) as ID&#13;
,key M.objvers&#13;
,BM.mbr_name&#13;
,S.sid as SID&#13;
$$LIST_OF_ATTR&#13;
&#13;
,txtlg as EVDESCRIPTION&#13;
,/b28/s_calc as CALC&#13;
,/b28/s_scaling as SCALING&#13;
,/b28/s_hir as HIR&#13;
//Ctrl+7&#13;
,BM.parenth1 as PARENTH1&#13;
,BM.parenth2 as PARENTH2&#13;
,BM.parenth3 as PARENTH3&#13;
,BM.parenth4 as PARENTH4&#13;
,BM.parenth5 as PARENTH5&#13;
,BM.parenth6 as PARENTH6&#13;
,BM.parenth7 as PARENTH7&#13;
,BM.parenth8 as PARENTH8&#13;
,BM.parenth9 as PARENTH9&#13;
&#13;
}&#13;
WHERE BM.mandt = $$session.client</template><template autoinsert="true" context="com.sap.adt.cds.ddl.ui.template.context.type.tablefunction.creation" deleted="false" description="BPC Models TF creation" enabled="true" name="define_BPC_TF_MODELS">@ClientHandling.type: #CLIENT_DEPENDENT&#13;
@ClientHandling.algorithm: #SESSION_VARIABLE&#13;
@AccessControl.authorizationCheck: #NOT_REQUIRED&#13;
@EndUserText.label: 'ZBPC_TF_$$MODEL'&#13;
//SELECT&#13;
//$$LIST_OF_DIMENSIONS&#13;
//,MEASURES&#13;
//,BASE_PERIOD&#13;
//,TIME_YEAR&#13;
//,SIGNEDDATA&#13;
//FROM ZBPC_TF_$$MODEL( SESSION_CONTEXT( 'CDS_CLIENT' ), '2022_01','2022_12', 'ACTUALS,B2022V2' );&#13;
define table function ZBPC_TF_$$MODEL&#13;
with parameters &#13;
@Environment.systemField: #CLIENT&#13;
p_mandt : mandt,&#13;
p_timefrom : /b28/oizodi75i,&#13;
p_timeto : /b28/oizodi75i,&#13;
p_version : rsdm4nodename&#13;
&#13;
returns {&#13;
MANDT : mandt;&#13;
&#13;
$$FIELDS_TF&#13;
&#13;
// for YTD Models for now&#13;
//MEASURES : uj_dim_member;&#13;
&#13;
BASE_PERIOD : sc_month;&#13;
TIME_YEAR: /bi0/oicalyear;&#13;
NEXT_MON: uj_dim_member;&#13;
PREV_MONT: uj_dim_member;&#13;
MONTHNUM : PERMONTH;&#13;
PREVMONTHNUM : PERMONTH;&#13;
YEAR_QTR: char7;&#13;
QTR : /bi0/oicalquarter;&#13;
NUMDAY  : /bi0/oinumday;&#13;
NUMWDAY : /bi0/oinumwday;&#13;
&#13;
SIGNEDDATA : /B28/OISDATA ;&#13;
}&#13;
implemented by method ZCL_BPC_AMDP_MODELS=&gt;$$MODEL;</template></templates>
